---
phase: 14
plan: 1
depends_on: []
must_haves:
  - "create-plan generates test blocks before action blocks"
  - "commit-task warns on missing test files"
---

# Phase 14, Plan 1: TDD Task Template & Binary Changes

## Goal
Modify the draht-tools binary to embed TDD into the plan template and commit workflow.

## Tasks

<task type="auto">
  <n>1. Update create-plan template with test→action→refactor</n>
  <files>~/bin/draht</files>
  <action>
    In the create-plan command, change the task template from:
    <task type="auto"> with <action>/<verify>/<done>
    To include <test> before <action> and <refactor> after:
    <test>[Write tests first — what should pass when done]</test>
    <action>[Implementation to make tests pass]</action>
    <refactor>[Optional cleanup after green]</refactor>
    <verify>[How to verify]</verify>
    <done>[What "done" looks like]</done>
  </action>
  <verify>Run draht create-plan 99 1 "test" and verify output contains test block</verify>
  <done>Plan template includes TDD structure</done>
</task>

<task type="auto">
  <n>2. Add test file check to commit-task</n>
  <files>~/bin/draht</files>
  <action>
    In commit-task, after the git commit, check if any staged files match test patterns
    (*.test.ts, *.spec.ts, *_test.go, *_test.ts). If no test files in the commit,
    print a warning: "⚠️  No test files in this commit — TDD requires tests first"
    Don't block the commit, just warn.
  </action>
  <verify>Commit without test files shows warning</verify>
  <done>commit-task warns on missing tests</done>
</task>

---
Created: 2026-02-28 20:55:00
